<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clone Splitwise - Divisor de Contas</title>
    <style>
        :root {
            --primary: #5bc5a7; /* Verde Splitwise */
            --dark: #333;
            --light: #f6f6f6;
            --danger: #ff652f;
            --success: #5bc5a7;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body { background-color: var(--light); color: var(--dark); padding-bottom: 50px;}

        /* Header */
        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 0 15px;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        h2 { font-size: 1.2rem; margin-bottom: 15px; border-bottom: 2px solid var(--light); padding-bottom: 10px; }

        /* Forms */
        .form-group { margin-bottom: 10px; }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 5px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 5px;
            background-color: var(--primary);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        button:hover { opacity: 0.9; }
        button.secondary { background-color: #666; margin-top: 10px;}

        /* Balances Styling */
        .balance-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        .owe { color: var(--danger); }
        .receive { color: var(--success); font-weight: bold; }

        /* List Styling */
        ul { list-style: none; }
        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #fdfdfd;
            border: 1px solid #eee;
            margin-bottom: 5px;
            border-radius: 5px;
        }
        .expense-info small { color: #888; display: block;}
        .delete-btn {
            background: transparent;
            color: #999;
            width: auto;
            padding: 5px;
            cursor: pointer;
            border: 1px solid #eee;
        }
        .delete-btn:hover { color: var(--danger); border-color: var(--danger); }

    </style>
</head>
<body>

<header>
    <h1>üí∞ Divisor de Contas</h1>
</header>

<div class="container">

    <div class="card">
        <h2>Balan√ßo Geral</h2>
        <div id="balanceList">
            <p style="text-align:center; color:#999;">Adicione pessoas e despesas para ver o saldo.</p>
        </div>
    </div>

    <div class="card">
        <h2>üë• Adicionar Amigo</h2>
        <div class="form-group">
            <input type="text" id="newPersonName" placeholder="Nome da pessoa (ex: Jo√£o)">
        </div>
        <button onclick="addPerson()">Adicionar Pessoa</button>
    </div>

    <div class="card">
        <h2>üí∏ Adicionar Despesa</h2>
        <div class="form-group">
            <label>Quem pagou?</label>
            <select id="payerSelect">
                <option value="" disabled selected>Selecione...</option>
            </select>
        </div>
        <div class="form-group">
            <input type="text" id="descInput" placeholder="Descri√ß√£o (ex: Pizza, Uber)">
        </div>
        <div class="form-group">
            <input type="number" id="amountInput" placeholder="Valor (R$)" step="0.01">
        </div>
        <button onclick="addExpense()">Dividir Igualmente</button>
    </div>

    <div class="card">
        <h2>üìú Hist√≥rico de Despesas</h2>
        <ul id="expensesList">
            </ul>
        <button class="secondary" onclick="resetApp()">Reiniciar Tudo</button>
    </div>

</div>

<script>
    // --- Estado da Aplica√ß√£o ---
    let people = [];
    let expenses = [];

    // --- Elementos do DOM ---
    const payerSelect = document.getElementById('payerSelect');
    const expensesList = document.getElementById('expensesList');
    const balanceList = document.getElementById('balanceList');

    // --- Fun√ß√µes Principais ---

    function addPerson() {
        const nameInput = document.getElementById('newPersonName');
        const name = nameInput.value.trim();

        if (name && !people.includes(name)) {
            people.push(name);
            updatePayerSelect();
            updateBalances(); // Recalcula caso haja despesas antigas
            nameInput.value = '';
            // Feedback visual r√°pido
            nameInput.placeholder = "Adicionado! Digite outro...";
            setTimeout(() => nameInput.placeholder = "Nome da pessoa (ex: Jo√£o)", 2000);
        } else if (people.includes(name)) {
            alert('Essa pessoa j√° est√° na lista.');
        } else {
            alert('Digite um nome v√°lido.');
        }
    }

    function addExpense() {
        const payer = payerSelect.value;
        const description = document.getElementById('descInput').value.trim();
        const amount = parseFloat(document.getElementById('amountInput').value);

        if (people.length < 2) {
            alert('Adicione pelo menos 2 pessoas para dividir a conta.');
            return;
        }

        if (!payer || !description || isNaN(amount) || amount <= 0) {
            alert('Preencha todos os campos corretamente.');
            return;
        }

        const expense = {
            id: Date.now(),
            payer: payer,
            description: description,
            amount: amount,
            date: new Date().toLocaleDateString()
        };

        expenses.push(expense);
        renderExpenses();
        updateBalances();
        
        // Limpar campos
        document.getElementById('descInput').value = '';
        document.getElementById('amountInput').value = '';
    }

    function removeExpense(id) {
        if(confirm('Tem certeza que deseja apagar esta despesa?')) {
            expenses = expenses.filter(exp => exp.id !== id);
            renderExpenses();
            updateBalances();
        }
    }

    // --- Atualiza√ß√£o da Interface ---

    function updatePayerSelect() {
        // Salva a sele√ß√£o atual se houver
        const currentSelection = payerSelect.value;
        
        payerSelect.innerHTML = '<option value="" disabled selected>Selecione...</option>';
        people.forEach(person => {
            const option = document.createElement('option');
            option.value = person;
            option.textContent = person;
            payerSelect.appendChild(option);
        });

        // Restaura sele√ß√£o se a pessoa ainda existir
        if (people.includes(currentSelection)) {
            payerSelect.value = currentSelection;
        }
    }

    function renderExpenses() {
        expensesList.innerHTML = '';
        expenses.slice().reverse().forEach(exp => {
            const li = document.createElement('li');
            li.className = 'expense-item';
            li.innerHTML = `
                <div class="expense-info">
                    <strong>${exp.description}</strong>
                    <small>${exp.payer} pagou R$ ${exp.amount.toFixed(2)}</small>
                </div>
                <div style="display:flex; align-items:center; gap:10px;">
                    <span style="font-weight:bold; color:var(--primary);">R$ ${exp.amount.toFixed(2)}</span>
                    <button class="delete-btn" onclick="removeExpense(${exp.id})" title="Apagar">üóëÔ∏è</button>
                </div>
            `;
            expensesList.appendChild(li);
        });
    }

    // --- L√≥gica de C√°lculo do Splitwise ---
    function updateBalances() {
        if (people.length === 0) return;

        let balances = {};
        
        // Inicializa zerado
        people.forEach(p => balances[p] = 0);

        // Calcula quem pagou o qu√™
        expenses.forEach(exp => {
            const payer = exp.payer;
            const amount = exp.amount;
            const splitAmount = amount / people.length; // Divis√£o simples igualit√°ria entre todos

            // Quem pagou recebe o valor total pago (cr√©dito)
            // Mas todos (inclusive quem pagou) devem a parcela (d√©bito)
            
            people.forEach(person => {
                if (person === payer) {
                    balances[person] += (amount - splitAmount);
                } else {
                    balances[person] -= splitAmount;
                }
            });
        });

        // Renderiza Balan√ßo
        balanceList.innerHTML = '';
        let hasData = false;

        for (const [person, amount] of Object.entries(balances)) {
            if (people.length > 0) hasData = true;
            
            const div = document.createElement('div');
            div.className = 'balance-item';
            
            let text = '';
            let classColor = '';

            // Toler√¢ncia pequena para erros de ponto flutuante
            if (amount > 0.01) {
                text = `recebe R$ ${amount.toFixed(2)}`;
                classColor = 'receive';
            } else if (amount < -0.01) {
                text = `deve R$ ${Math.abs(amount).toFixed(2)}`;
                classColor = 'owe';
            } else {
                text = 'est√° quite';
                classColor = 'text-muted';
            }

            div.innerHTML = `<span>${person}</span> <span class="${classColor}">${text}</span>`;
            balanceList.appendChild(div);
        }

        if (!hasData) {
            balanceList.innerHTML = '<p style="text-align:center; color:#999;">Adicione pessoas e despesas.</p>';
        }
    }

    function resetApp() {
        if(confirm("Isso apagar√° todos os dados. Continuar?")) {
            people = [];
            expenses = [];
            updatePayerSelect();
            renderExpenses();
            updateBalances();
        }
    }
</script>

</body>
</html>

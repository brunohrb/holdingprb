<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clone Splitwise - Sele√ß√£o M√∫ltiplas</title>
    <style>
        :root {
            --primary: #5bc5a7; /* Verde Splitwise */
            --dark: #333;
            --light: #f6f6f6;
            --danger: #ff652f;
            --success: #5bc5a7;
            --border: #ddd;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        
        body { background-color: var(--light); color: var(--dark); padding-bottom: 80px;}

        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .container { max-width: 600px; margin: 20px auto; padding: 0 15px; }

        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        h2 { font-size: 1.1rem; margin-bottom: 15px; border-bottom: 2px solid var(--light); padding-bottom: 10px; color: #444;}

        /* Form Elements */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9rem; }
        
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
        }

        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 6px;
            background-color: var(--primary);
            color: white;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
        }
        button:hover { filter: brightness(90%); }
        button.secondary { background-color: #6c757d; margin-top: 10px; }

        /* Participantes Checkboxes */
        .participants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            margin-top: 5px;
        }

        .participant-option {
            position: relative;
        }

        .participant-option input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .participant-option label {
            display: block;
            background: #eee;
            padding: 8px;
            text-align: center;
            border-radius: 4px;
            cursor: pointer;
            border: 1px solid transparent;
            font-weight: normal;
            font-size: 0.85rem;
            margin: 0;
            transition: 0.2s;
        }

        /* Estilo quando selecionado */
        .participant-option input:checked + label {
            background-color: #e0f7fa;
            border-color: var(--primary);
            color: var(--primary);
            font-weight: bold;
        }
        
        .participant-option input:checked + label::before {
            content: '‚úî ';
        }

        /* Balances */
        .balance-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .owe { color: var(--danger); }
        .receive { color: var(--success); font-weight: bold; }

        /* Lista de Despesas */
        ul { list-style: none; }
        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #fff;
            border: 1px solid #eee;
            margin-bottom: 8px;
            border-radius: 6px;
        }
        .expense-details small { color: #777; font-size: 0.8rem; display: block; margin-top: 2px;}
        .delete-btn {
            background: transparent;
            color: #999;
            width: auto;
            padding: 5px 10px;
            font-size: 1.2rem;
        }
        .delete-btn:hover { color: var(--danger); background: transparent; }

    </style>
</head>
<body>

<header>
    <h1>‚öñÔ∏è Divisor Flex√≠vel</h1>
</header>

<div class="container">

    <div class="card">
        <h2>üí∞ Balan√ßo L√≠quido</h2>
        <div id="balanceList">
            <p style="text-align:center; color:#999; padding: 10px;">Adicione pessoas e despesas.</p>
        </div>
    </div>

    <div class="card">
        <h2>üë• Adicionar Pessoas</h2>
        <div style="display: flex; gap: 10px;">
            <input type="text" id="newPersonName" placeholder="Nome (ex: Ana)">
            <button onclick="addPerson()" style="width: auto;">+</button>
        </div>
        <div id="peopleTags" style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 5px;">
            </div>
    </div>

    <div class="card">
        <h2>üí∏ Nova Despesa</h2>
        
        <div class="form-group">
            <input type="text" id="descInput" placeholder="Descri√ß√£o (ex: Jantar, Uber)">
        </div>
        
        <div class="form-group">
            <input type="number" id="amountInput" placeholder="Valor (R$)" step="0.01">
        </div>

        <div class="form-group">
            <label>Quem pagou?</label>
            <select id="payerSelect">
                <option value="" disabled selected>Selecione...</option>
            </select>
        </div>

        <div class="form-group">
            <label>Para quem foi? (Dividir entre:)</label>
            <div id="participantsContainer" class="participants-grid">
                <p style="color:#999; font-size: 0.9rem;">Adicione pessoas primeiro...</p>
            </div>
            <small style="color:#666; font-size: 0.8rem; margin-top: 5px; display:block;">Toque nos nomes para marcar/desmarcar.</small>
        </div>

        <button onclick="addExpense()">Salvar Despesa</button>
    </div>

    <div class="card">
        <h2>üìú Hist√≥rico</h2>
        <ul id="expensesList"></ul>
        <button class="secondary" onclick="resetApp()">Limpar Tudo</button>
    </div>

</div>

<script>
    // --- Estado ---
    let people = [];
    let expenses = [];

    // --- DOM Elements ---
    const payerSelect = document.getElementById('payerSelect');
    const participantsContainer = document.getElementById('participantsContainer');
    const expensesList = document.getElementById('expensesList');
    const balanceList = document.getElementById('balanceList');
    const peopleTags = document.getElementById('peopleTags');

    // --- Adicionar Pessoa ---
    function addPerson() {
        const nameInput = document.getElementById('newPersonName');
        const name = nameInput.value.trim();

        if (name && !people.includes(name)) {
            people.push(name);
            nameInput.value = '';
            updateUI();
        } else if (people.includes(name)) {
            alert('Nome j√° existe!');
        }
    }

    // --- Adicionar Despesa ---
    function addExpense() {
        const desc = document.getElementById('descInput').value.trim();
        const amount = parseFloat(document.getElementById('amountInput').value);
        const payer = payerSelect.value;
        
        // Pegar quem foi marcado nos checkboxes
        const checkboxes = document.querySelectorAll('.participant-checkbox:checked');
        const involved = Array.from(checkboxes).map(cb => cb.value);

        // Valida√ß√µes
        if (!desc || isNaN(amount) || amount <= 0 || !payer) {
            alert('Preencha descri√ß√£o, valor e quem pagou.');
            return;
        }
        if (involved.length === 0) {
            alert('Selecione pelo menos uma pessoa para dividir a conta.');
            return;
        }

        const expense = {
            id: Date.now(),
            desc,
            amount,
            payer,
            involved, // Array com os nomes de quem participa da divis√£o
            date: new Date().toLocaleDateString()
        };

        expenses.push(expense);
        
        // Limpar form
        document.getElementById('descInput').value = '';
        document.getElementById('amountInput').value = '';
        // Manter checkboxes marcados por conveni√™ncia ou resetar? Vamos resetar para todos marcados
        checkAllParticipants();

        updateBalances();
        renderExpenses();
    }

    function removeExpense(id) {
        if(confirm('Apagar despesa?')) {
            expenses = expenses.filter(e => e.id !== id);
            updateBalances();
            renderExpenses();
        }
    }

    // --- Renderiza√ß√£o da Interface ---
    function updateUI() {
        renderPayerSelect();
        renderParticipantsCheckboxes();
        renderPeopleTags();
        updateBalances(); // Recalcula caso adicione pessoa nova
    }

    function renderPeopleTags() {
        peopleTags.innerHTML = people.map(p => 
            `<span style="background:#e0e0e0; padding:2px 8px; border-radius:10px; font-size:0.8rem;">${p}</span>`
        ).join('');
    }

    function renderPayerSelect() {
        const current = payerSelect.value;
        payerSelect.innerHTML = '<option value="" disabled selected>Selecione...</option>';
        people.forEach(p => {
            const opt = document.createElement('option');
            opt.value = p;
            opt.textContent = p;
            payerSelect.appendChild(opt);
        });
        if(people.includes(current)) payerSelect.value = current;
    }

    function renderParticipantsCheckboxes() {
        participantsContainer.innerHTML = '';
        if (people.length === 0) {
            participantsContainer.innerHTML = '<p style="color:#999;">Adicione pessoas acima.</p>';
            return;
        }

        people.forEach(p => {
            const div = document.createElement('div');
            div.className = 'participant-option';
            // Por padr√£o, todos v√™m marcados (checked)
            div.innerHTML = `
                <input type="checkbox" id="cb_${p}" value="${p}" class="participant-checkbox" checked>
                <label for="cb_${p}">${p}</label>
            `;
            participantsContainer.appendChild(div);
        });
    }
    
    function checkAllParticipants() {
        document.querySelectorAll('.participant-checkbox').forEach(cb => cb.checked = true);
    }

    function renderExpenses() {
        expensesList.innerHTML = '';
        expenses.slice().reverse().forEach(exp => {
            const li = document.createElement('li');
            li.className = 'expense-item';
            
            // Texto resumo (ex: dividido entre 3 pessoas)
            const involvedText = exp.involved.length === people.length 
                ? 'todos' 
                : `${exp.involved.length} pessoas`;

            li.innerHTML = `
                <div class="expense-details">
                    <strong>${exp.desc}</strong>
                    <small>${exp.payer} pagou R$ ${exp.amount.toFixed(2)}</small>
                    <small style="color:var(--primary)">Dividido entre: ${involvedText}</small>
                </div>
                <div style="display:flex; align-items:center;">
                    <span style="font-weight:bold; margin-right:10px;">R$ ${exp.amount.toFixed(2)}</span>
                    <button class="delete-btn" onclick="removeExpense(${exp.id})">√ó</button>
                </div>
            `;
            expensesList.appendChild(li);
        });
    }

    // --- L√ìGICA DE C√ÅLCULO (O CORA√á√ÉO DO SPLITWISE) ---
    function updateBalances() {
        if (people.length === 0) return;

        let balances = {};
        people.forEach(p => balances[p] = 0);

        expenses.forEach(exp => {
            const payer = exp.payer;
            const amount = exp.amount;
            const involved = exp.involved; // Array de quem participa [A, B, C]
            
            // Valor por pessoa (apenas entre as envolvidas)
            const share = amount / involved.length;

            // Quem pagou "recebe" o valor total de volta nos c√°lculos intermedi√°rios
            // (Matematicamente: Cr√©dito de quem pagou)
            if (people.includes(payer)) {
                balances[payer] += amount;
            }

            // Cada envolvido "deve" sua parte (D√©bito)
            involved.forEach(person => {
                if (balances.hasOwnProperty(person)) {
                    balances[person] -= share;
                }
            });
        });

        // Renderizar
        balanceList.innerHTML = '';
        let hasData = false;
        
        // Filtrar e mostrar saldos
        Object.keys(balances).forEach(person => {
            const val = balances[person];
            if (Math.abs(val) < 0.01) return; // Ignora zeros
            
            hasData = true;
            const div = document.createElement('div');
            div.className = 'balance-item';
            
            if (val > 0) {
                div.innerHTML = `<span>${person}</span> <span class="receive">recebe R$ ${val.toFixed(2)}</span>`;
            } else {
                div.innerHTML = `<span>${person}</span> <span class="owe">deve R$ ${Math.abs(val).toFixed(2)}</span>`;
            }
            balanceList.appendChild(div);
        });

        if (!hasData && people.length > 0) {
            balanceList.innerHTML = '<p style="text-align:center; color:green;">Tudo quitado! Ningu√©m deve nada.</p>';
        } else if (people.length === 0) {
            balanceList.innerHTML = '<p style="text-align:center; color:#999; padding:10px;">Adicione pessoas e despesas.</p>';
        }
    }

    function resetApp() {
        if(confirm("Reiniciar tudo?")) {
            people = [];
            expenses = [];
            updateUI();
            renderExpenses();
        }
    }
</script>

</body>
</html>

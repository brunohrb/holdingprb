<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotyfi do Carnaval - Divisor de Contas</title>
    <style>
        /* --- PALETA DE CORES "SPOTYFI" --- */
        :root {
            --bg-main: #121212;      /* Fundo principal preto */
            --bg-card: #181818;      /* Fundo dos cartÃµes (cinza muito escuro) */
            --bg-input: #282828;     /* Fundo dos inputs */
            --primary: #1DB954;      /* Verde Spotify Neon */
            --text-light: #FFFFFF;   /* Texto branco */
            --text-muted: #B3B3B3;   /* Texto cinza claro */
            --danger: #E91429;       /* Vermelho vibrante para dÃ­vidas/apagar */
            --border-radius: 12px;   /* Bordas arredondadas modernas */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Circular Std', 'Segoe UI', Tahoma, sans-serif; }
        
        body { 
            background-color: var(--bg-main); 
            color: var(--text-light); 
            padding-bottom: 80px;
        }

        /* Header estilo App de MÃºsica */
        header {
            background: linear-gradient(180deg, rgba(29,185,84,0.15) 0%, var(--bg-main) 100%);
            padding: 1.5rem 1rem;
            text-align: center;
        }
        header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .container { max-width: 500px; margin: 0 auto; padding: 15px; }

        /* Cards Modernos e Escuros */
        .card {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        h2 { 
            font-size: 1.1rem; 
            margin-bottom: 15px; 
            color: var(--text-light);
            font-weight: 600;
        }

        /* Inputs Estilizados */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 0.9rem; font-weight: 600;}
        
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 14px;
            background-color: var(--bg-input);
            border: 1px solid transparent;
            color: var(--text-light);
            border-radius: 6px;
            font-size: 1rem;
            transition: 0.3s;
        }
        input::placeholder { color: #666; }
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(29,185,84,0.2);
        }

        /* BotÃµes Estilo "Play" */
        button {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 50px; /* BotÃ£o pÃ­lula */
            background-color: var(--primary);
            color: #000; /* Texto preto no verde para contraste */
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s, filter 0.2s;
        }
        button:hover { filter: brightness(1.1); transform: scale(1.02); }
        button:active { transform: scale(0.98); }
        
        button.secondary { 
            background-color: transparent; 
            border: 1px solid var(--text-muted); 
            color: var(--text-light);
            margin-top: 10px;
        }
        button.small-btn {
            width: auto;
            padding: 14px 20px;
            border-radius: 6px;
        }

        /* Participantes Checkboxes (Tags estilo playlist) */
        .participants-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 5px;
        }

        .participant-option { position: relative; }
        .participant-option input { position: absolute; opacity: 0; cursor: pointer; }

        .participant-option label {
            display: block;
            background: var(--bg-input);
            color: var(--text-muted);
            padding: 10px 16px;
            text-align: center;
            border-radius: 50px;
            cursor: pointer;
            border: 1px solid #333;
            font-weight: 500;
            font-size: 0.9rem;
            transition: 0.2s;
        }

        /* Estilo quando selecionado */
        .participant-option input:checked + label {
            background-color: var(--primary);
            color: #000;
            border-color: var(--primary);
            font-weight: bold;
        }
        
        /* Tags de pessoas adicionadas */
        .person-tag {
            background: #333;
            color: var(--text-light);
            padding: 5px 12px;
            border-radius: 50px;
            font-size: 0.85rem;
            display: inline-block;
        }

        /* Balances */
        .balance-item {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #333;
            font-size: 1.1rem;
        }
        .owe { color: var(--danger); }
        .receive { color: var(--primary); font-weight: bold; }

        /* Lista de Despesas */
        ul { list-style: none; }
        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--bg-input);
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid var(--primary); /* Detalhe verde lateral */
        }
        .expense-details strong { display: block; font-size: 1.05rem; margin-bottom: 4px;}
        .expense-details small { color: var(--text-muted); font-size: 0.85rem; display: block;}
        
        .delete-btn {
            background: transparent;
            color: var(--text-muted);
            width: 40px; height: 40px;
            padding: 0;
            font-size: 1.5rem;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }
        .delete-btn:hover { color: var(--danger); background: rgba(233,20,41,0.1); }

    </style>
</head>
<body>

<header>
    <h1>ðŸŽµ Spotyfi do Carnaval</h1>
    <p style="color: var(--text-muted); font-size: 0.9rem;">Divide a conta, nÃ£o a folia!</p>
</header>

<div class="container">

    <div class="card" style="border-top: 4px solid var(--primary);">
        <h2>ðŸ’° Saldo da Folia</h2>
        <div id="balanceList">
            <p style="text-align:center; color:var(--text-muted); padding: 20px;">Cadastre os foliÃµes para comeÃ§ar.</p>
        </div>
    </div>

    <div class="card">
        <h2>ðŸ‘¥ Adicionar FoliÃ£o</h2>
        <div style="display: flex; gap: 10px;">
            <input type="text" id="newPersonName" placeholder="Nome ou apelido">
            <button onclick="addPerson()" class="small-btn">Adicionar</button>
        </div>
        <div id="peopleTags" style="margin-top: 15px; display: flex; flex-wrap: wrap; gap: 8px;">
            </div>
    </div>

    <div class="card">
        <h2>ðŸ’¸ LanÃ§ar Gastos</h2>
        
        <div class="form-group">
             <label>O que foi?</label>
            <input type="text" id="descInput" placeholder="Ex: Cerveja, Uber, AbadÃ¡...">
        </div>
        
        <div class="form-group">
            <label>Valor (R$)</label>
            <input type="number" id="amountInput" placeholder="0.00" step="0.01">
        </div>

        <div class="form-group">
            <label>Quem pagou essa rodada?</label>
            <select id="payerSelect">
                <option value="" disabled selected>Selecione o pagador...</option>
            </select>
        </div>

        <div class="form-group" style="margin-top: 25px;">
            <label style="color: var(--primary);">Quem participou/consumiu? (Toque para marcar)</label>
            <div id="participantsContainer" class="participants-grid">
                <p style="color:var(--text-muted); font-size: 0.9rem; padding: 10px 0;">Adicione pessoas primeiro...</p>
            </div>
        </div>

        <button onclick="addExpense()" style="margin-top: 20px;">SALVAR DESPESA</button>
    </div>

    <div class="card">
        <h2>ðŸ“œ HistÃ³rico de Gastos</h2>
        <ul id="expensesList"></ul>
        <button class="secondary" onclick="resetApp()">Apagar tudo e reiniciar</button>
    </div>

</div>

<script>
    // --- Estado ---
    let people = [];
    let expenses = [];

    // --- DOM Elements ---
    const payerSelect = document.getElementById('payerSelect');
    const participantsContainer = document.getElementById('participantsContainer');
    const expensesList = document.getElementById('expensesList');
    const balanceList = document.getElementById('balanceList');
    const peopleTags = document.getElementById('peopleTags');

    // --- Adicionar Pessoa ---
    function addPerson() {
        const nameInput = document.getElementById('newPersonName');
        const name = nameInput.value.trim();

        if (name && !people.includes(name)) {
            people.push(name);
            nameInput.value = '';
            updateUI();
        } else if (people.includes(name)) {
            alert('Esse foliÃ£o jÃ¡ estÃ¡ na lista!');
        }
    }

    // --- Adicionar Despesa ---
    function addExpense() {
        const desc = document.getElementById('descInput').value.trim();
        const amount = parseFloat(document.getElementById('amountInput').value);
        const payer = payerSelect.value;
        
        // Pegar quem foi marcado nos checkboxes
        const checkboxes = document.querySelectorAll('.participant-checkbox:checked');
        const involved = Array.from(checkboxes).map(cb => cb.value);

        // ValidaÃ§Ãµes
        if (!desc || isNaN(amount) || amount <= 0 || !payer) {
            alert('Preencha descriÃ§Ã£o, valor e quem pagou.');
            return;
        }
        if (involved.length === 0) {
            alert('Selecione pelo menos uma pessoa que participou da despesa.');
            return;
        }

        const expense = {
            id: Date.now(),
            desc,
            amount,
            payer,
            involved, 
            date: new Date().toLocaleDateString()
        };

        expenses.push(expense);
        
        // Limpar form
        document.getElementById('descInput').value = '';
        document.getElementById('amountInput').value = '';
        checkAllParticipants(); // Reseta marcando todos para facilitar a prÃ³xima

        updateBalances();
        renderExpenses();
    }

    function removeExpense(id) {
        // Usando um confirm nativo mais simples para combinar com o tema dark
        if(confirm('Remover esta despesa do histÃ³rico?')) {
            expenses = expenses.filter(e => e.id !== id);
            updateBalances();
            renderExpenses();
        }
    }

    // --- RenderizaÃ§Ã£o da Interface ---
    function updateUI() {
        renderPayerSelect();
        renderParticipantsCheckboxes();
        renderPeopleTags();
        updateBalances(); 
    }

    function renderPeopleTags() {
        peopleTags.innerHTML = people.map(p => 
            `<span class="person-tag">${p}</span>`
        ).join('');
    }

    function renderPayerSelect() {
        const current = payerSelect.value;
        payerSelect.innerHTML = '<option value="" disabled selected>Selecione o pagador...</option>';
        people.forEach(p => {
            const opt = document.createElement('option');
            opt.value = p;
            opt.textContent = p;
            payerSelect.appendChild(opt);
        });
        if(people.includes(current)) payerSelect.value = current;
    }

    function renderParticipantsCheckboxes() {
        participantsContainer.innerHTML = '';
        if (people.length === 0) {
            participantsContainer.innerHTML = '<p style="color:var(--text-muted);">Adicione foliÃµes acima.</p>';
            return;
        }

        people.forEach(p => {
            const div = document.createElement('div');
            div.className = 'participant-option';
            // Por padrÃ£o, todos vÃªm marcados
            div.innerHTML = `
                <input type="checkbox" id="cb_${p}" value="${p}" class="participant-checkbox" checked>
                <label for="cb_${p}">${p}</label>
            `;
            participantsContainer.appendChild(div);
        });
    }
    
    function checkAllParticipants() {
        document.querySelectorAll('.participant-checkbox').forEach(cb => cb.checked = true);
    }

    function renderExpenses() {
        expensesList.innerHTML = '';
        if (expenses.length === 0) {
             expensesList.innerHTML = '<p style="color:var(--text-muted); text-align:center; padding:10px;">Nenhuma despesa lanÃ§ada.</p>';
             return;
        }
        expenses.slice().reverse().forEach(exp => {
            const li = document.createElement('li');
            li.className = 'expense-item';
            
            const involvedText = exp.involved.length === people.length 
                ? 'todos' 
                : `${exp.involved.length} pessoas`;

            li.innerHTML = `
                <div class="expense-details">
                    <strong>${exp.desc}</strong>
                    <small style="color: var(--primary)">${exp.payer} pagou R$ ${exp.amount.toFixed(2)}</small>
                    <small>Dividido entre: ${involvedText}</small>
                </div>
                <div style="display:flex; align-items:center;">
                    <span style="font-weight:bold; margin-right:15px; font-size:1.1rem;">R$ ${exp.amount.toFixed(2)}</span>
                    <button class="delete-btn" onclick="removeExpense(${exp.id})">âœ•</button>
                </div>
            `;
            expensesList.appendChild(li);
        });
    }

    // --- LÃ“GICA DE CÃLCULO ---
    function updateBalances() {
        if (people.length === 0) return;

        let balances = {};
        people.forEach(p => balances[p] = 0);

        expenses.forEach(exp => {
            const payer = exp.payer;
            const amount = exp.amount;
            const involved = exp.involved; 
            
            const share = amount / involved.length;

            if (people.includes(payer)) {
                balances[payer] += amount;
            }

            involved.forEach(person => {
                if (balances.hasOwnProperty(person)) {
                    balances[person] -= share;
                }
            });
        });

        // Renderizar
        balanceList.innerHTML = '';
        let hasData = false;
        
        Object.keys(balances).forEach(person => {
            const val = balances[person];
            if (Math.abs(val) < 0.01) return; 
            
            hasData = true;
            const div = document.createElement('div');
            div.className = 'balance-item';
            
            // Ãcones de seta para dar um charme
            if (val > 0) {
                div.innerHTML = `<span>${person}</span> <span class="receive">â†— recebe R$ ${val.toFixed(2)}</span>`;
            } else {
                div.innerHTML = `<span>${person}</span> <span class="owe">â†™ deve R$ ${Math.abs(val).toFixed(2)}</span>`;
            }
            balanceList.appendChild(div);
        });

        if (!hasData && people.length > 0) {
            balanceList.innerHTML = '<p style="text-align:center; color:var(--primary); padding:20px; font-weight:bold;">Tudo quitado! Segue o baile! ðŸŽ‰</p>';
        } else if (people.length === 0) {
            balanceList.innerHTML = '<p style="text-align:center; color:var(--text-muted); padding: 20px;">Cadastre os foliÃµes para comeÃ§ar.</p>';
        }
    }

    function resetApp() {
        if(confirm("Isso apagarÃ¡ todos os dados da folia. Tem certeza?")) {
            people = [];
            expenses = [];
            updateUI();
            renderExpenses();
        }
    }
</script>

</body>
</html>
